{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/vlookup-in-r-python","result":{"data":{"markdownRemark":{"id":"a3f063f1-308d-5741-811b-f8cf670c3ad6","html":"<p>If your moving into R or python from excel than you know what I am talking about. If python/R/SQL where you first tool for data analysis than you will never understand the pain.  </p>\n<p>Vlookup or index/match are basic building block of excel data analysis and reporting.  </p>\n<p>First question while using R was how the hell will I use Vlookup in R?<em>(All my report had vlookup at least one time, and also I was naive and didn’t understood the concept of relation databases) .</em> I googled it, answers were not lucid. If you google it most probability you will come across use <strong><em>merge as answer.</em></strong> Merge is base function in R, like most base function<em>(except very few)</em> it complected to use. Plus most excel user are not that familiar with relationship i,e relation database (there might be few exception if you use pivot table a lot) , for them info in each cell are different. Excel user never think data as column, info in each cell is separate for them. We (excel user) thinking about how we will add two cell, how will we look value of cell A1 on table B1:C10. We never think as lets look value of column A into table B:C. or add column A to B.  </p>\n<p><em><strong>Advice:</strong> If you come from excel background start thinking all data as column  and starts respecting the structure of data. In excel you can add any two cells (A1 and A5) and put that somewhere in  C5, have different type of data in one column(like number in A1, date A2, string in third ). Always think any operation as column operation not cells operation. Like if you have to add two series, put it under different column and add these to make third column. Any analysis, reporting, manipulation only consists of joining column and than summarizing(visualization, modeling).</em><br>\n<strong>Lets break down Vlookup,</strong><br>\n<em>Vlookup - takes a value say “A” than find that value “A” in next table than pull info related to “A” from  this table.</em><br>\nThis is called joining in database and R, you take list of value and join(match these value in next table) and pull info related to these value.  </p>\n<p><strong>lets take an example</strong>   </p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token comment\">##make data frame</span>\nmaster <span class=\"token operator\">&lt;-</span>  data.frame<span class=\"token punctuation\">(</span>ID <span class=\"token operator\">=</span> <span class=\"token number\">1</span><span class=\"token operator\">:</span><span class=\"token number\">50</span><span class=\"token punctuation\">,</span> name <span class=\"token operator\">=</span> letters<span class=\"token punctuation\">[</span><span class=\"token number\">1</span><span class=\"token operator\">:</span><span class=\"token number\">50</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\ndate <span class=\"token operator\">=</span> seq<span class=\"token punctuation\">(</span>as.Date<span class=\"token punctuation\">(</span><span class=\"token string\">\"2016-01-01\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> by <span class=\"token operator\">=</span> <span class=\"token string\">\"week\"</span><span class=\"token punctuation\">,</span> len <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\ndf <span class=\"token operator\">=</span> pd.DataFrame</code></pre></div>\n<p>We have different list which only has id</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token comment\">##lookup valuer</span>\nlookup <span class=\"token operator\">=</span>data.frame<span class=\"token punctuation\">(</span>id <span class=\"token operator\">=</span>  c<span class=\"token punctuation\">(</span><span class=\"token number\">23</span><span class=\"token punctuation\">,</span> <span class=\"token number\">50</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token number\">45</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now we need to look up name of these id in master data.frame.</p>\n<p>Install dplyr  and load R or pandas in python</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token comment\">##load dplyr</span>\nrequired<span class=\"token punctuation\">(</span>dplyr<span class=\"token punctuation\">)</span></code></pre></div>\n<p>dplyr has many user friendly join function.<br>\n<img src=\"/media/join.png\" alt=\"join\"></p>\n<p>lets get back to problem</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token comment\">##lookup</span>\nid_lookup <span class=\"token operator\">=</span> left_join<span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> master<span class=\"token punctuation\">,</span> by<span class=\"token operator\">=</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\"># output are only value that </span>\n                          <span class=\"token operator\">></span>matches to id_lookup<span class=\"token punctuation\">,</span> <span class=\"token keyword\">if</span> no match is found it return as <span class=\"token keyword\">NA</span>\nor\nid_lookup <span class=\"token operator\">=</span> right_join<span class=\"token punctuation\">(</span>master<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> by<span class=\"token operator\">=</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">##both column should have common name</span></code></pre></div>\n<p>If column name are different you can</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token comment\">##If column name are different you can</span>\nid_lookup <span class=\"token operator\">=</span> right_join<span class=\"token punctuation\">(</span>master<span class=\"token punctuation\">,</span> id<span class=\"token punctuation\">,</span> by<span class=\"token operator\">=</span>c<span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token operator\">=</span><span class=\"token string\">\"id2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>or rename column using</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\">colnames<span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">[</span>x<span class=\"token punctuation\">]</span>  <span class=\"token operator\">=</span> <span class=\"token string\">\"id\"</span>   <span class=\"token comment\"># x is cloumn index</span>\nid_lookup <span class=\"token operator\">=</span> rename<span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> id<span class=\"token operator\">=</span>id2<span class=\"token punctuation\">)</span>  <span class=\"token comment\"># rename is dplyr function</span></code></pre></div>\n<p>New id_lookup will have colnames as “id”,“name”,“date”. If you don’t need date you can always make subset of dataframe. Or before join make subset of master</p>\n<div class=\"gatsby-highlight\" data-language=\"r\"><pre class=\"language-r\"><code class=\"language-r\"><span class=\"token comment\">##subset of data</span>\n\nid_lookup <span class=\"token operator\">=</span> id_lookup<span class=\"token punctuation\">[</span> <span class=\"token punctuation\">,</span> <span class=\"token operator\">-</span>c<span class=\"token punctuation\">(</span><span class=\"token string\">\"date\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\nor\nid_lookup <span class=\"token operator\">=</span> id_lookup<span class=\"token punctuation\">[</span> <span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"date\"</span><span class=\"token punctuation\">)</span>\nor\nid_lookup <span class=\"token operator\">=</span> id_lookup<span class=\"token punctuation\">[</span><span class=\"token punctuation\">,</span>c<span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\nor\nid_lookup <span class=\"token operator\">=</span> subset<span class=\"token punctuation\">(</span>id_lookup<span class=\"token punctuation\">,</span> condition<span class=\"token punctuation\">,</span> select<span class=\"token operator\">=</span>c<span class=\"token punctuation\">(</span><span class=\"token string\">\"id\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"date\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Get used to with joins, these are all joins you we need to perform any lookup. You never perform look for only particular value only, its always column look up. Best practices is always make data.frame of what you have to look up and  join to next table. </p>\n<blockquote>\n<p>“Reputation is like fine china, expensive to acquire, and easily broken. If you are not sure if something is right or wrong, consider whether you’d want it reported in the morning paper.”</p>\n<p>—Alice Schroeder, The Snowball: Warren Buffett and the Business of Life</p>\n</blockquote>","fields":{"slug":"/posts/vlookup-in-r-python","tagSlugs":["/tag/python/","/tag/r/","/tag/join/"]},"frontmatter":{"date":"2020-06-03T22:12:03.284Z","description":"If your moving into R or python from excel than you know what I am talking about. If python/R/SQL where you first tool for data analysis than you will never understand the pain.","tags":["python","r","join"],"title":"Vlookup in R AND Python","socialImage":"/media/join.png"}}},"pageContext":{"slug":"/posts/vlookup-in-r-python"}}}